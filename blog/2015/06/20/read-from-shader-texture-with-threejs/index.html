<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <meta charset="utf-8" />

        <script type="text/javascript">
            (function() {
              var hm = document.createElement("script");
              hm.src = "//hm.baidu.com/hm.js?dcee78e565eeaedc76defba5d096b344";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-38205696-1']);
            _gaq.push(['_trackPageview']);
            (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>

        <meta name="description" content="Web Develope Blog by Devin Shen" />
        <meta name="viewport" content="width=100%, initial-scale=1" />

        <link rel="shortcut icon" href="http://shenjl.github.io.com/blog/img//owl.ico" />
        <link rel="stylesheet" type="text/css" href="http://shenjl.github.io/blog/css/default.min.css" />
    </head>
    
    <body>

        <div id="music-panel">
    <a id="music-control" href="javascript:;" onclick="toggleMusicPanel()"></a>
    <div id="music-content">
        <!-- use lazy loading -->
        <!--iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="http://music.163.com/outchain/player?type=0&id=49176408&auto=0&height=430"></iframe-->
    </div>
</div>


        
        
        <div id="mobile-nav">
            <a href="http://zhangwenli.com" onclick="_gaq.push(['_trackEvent', 'ToHome', 'InNavMobile', window.location.pathname]);">Home</a><a href="http://shenjl.github.io/blog" onclick="_gaq.push(['_trackEvent', 'ToBlog', 'InNavMobile', window.location.pathname]);">Blog</a>
        </div>
        <div class="contentDiv">


<title>Get Video from Local Camera & Read from Shader Texture with Three.js
    
        : Polyvia
    
 - 羡辙杂俎</title>




<div class="rotLeft rotTop pageBack"></div>
<div class="rotRight rotTop pageBack"></div>
<div class="container page page-post">
    

    <div class="simpleNav">
        <a href="http://zhangwenli.com" class="pageDiv" onclick="_gaq.push(['_trackEvent', 'ToHome', 'InPost', window.location.pathname]);">Home</a>
        <a href="http://shenjl.github.io/blog" class="pageDiv" onclick="_gaq.push(['_trackEvent', 'ToBlog', 'InPost', window.location.pathname]);">Blog</a>
    </div>

    
    
    <div class="timeago" title="2015-06-20T19:51:11+08:00">2015.06.20 19:51:11</div>

    
    <div class="pageTitle">Get Video from Local Camera & Read from Shader Texture with Three.js</div>

    <div class="tagPanel">
    <a href="http://shenjl.github.io/blog/all?tag=JavaScript" onclick="_gaq.push(['_trackEvent', 'ToTag', 'InPost', window.location.pathname]);"><div class="tag">JavaScript</div></a><a href="http://shenjl.github.io/blog/all?tag=ThreeJs" onclick="_gaq.push(['_trackEvent', 'ToTag', 'InPost', window.location.pathname]);"><div class="tag">ThreeJs</div></a><a href="http://shenjl.github.io/blog/all?tag=WebGL" onclick="_gaq.push(['_trackEvent', 'ToTag', 'InPost', window.location.pathname]);"><div class="tag">WebGL</div></a><a href="http://shenjl.github.io/blog/all?tag=Shader" onclick="_gaq.push(['_trackEvent', 'ToTag', 'InPost', window.location.pathname]);"><div class="tag">Shader</div></a>
    </div>

    

    
        <blockquote class="seriesNote">

    <h4>Series: Polyvia</h4>

    
    <ul>
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/04/14/jade-for-github-pages/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Jade for GitHub Pages
            
            
            
                </a>
            
            </li>
        
    
        
    
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/05/29/upload-images-with-dat-gui/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Upload Images with dat.GUI
            
            
            
                </a>
            
            </li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/06/13/wrapping-third-party-libraries-for-requirejs/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Wrapping Third-Party Libraries for RequireJS
            
            
            
                </a>
            
            </li>
        
    
        
    
        
            
                <li class="series-self">
            
            
            
                Get Video from Local Camera & Read from Shader Texture with Three.js
            
            
            
            </li>
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/06/25/polyvia/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Low-Poly 风格的图像、视频处理 Polyvia
            
            
            
                </a>
            
            </li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    </ul>
</blockquote>

    



    <div id="page-view"></div>


    
    <blockquote>
  <p>A shader is software which runs on a graphics card to determine how an object should be drawn. Source uses shaders for everything in the 3D world. Shaders are manipulated with parameters stored in material files.</p>
</blockquote>

<blockquote>
  <p>From <em><a href="https://developer.valvesoftware.com/wiki/Shader" target="_blank">https://developer.valvesoftware.com/wiki/Shader</a></em></p>
</blockquote>

<p><a href="https://www.opengl.org/documentation/glsl/" target="_blank">GLSL</a> is the OpenGL Shading Language, with which we can write amazing shaders like those on <a href="https://www.shadertoy.com/" target="_blank">Shadertoy</a>.</p>

<p>With <a href="http://threejs.org/" target="_blank">Three.js</a>, the process of writing shaders is made much easier. You may write shader programs by yourself as the <a href="https://github.com/mrdoob/three.js/blob/2761f1b161c2da0d46a1bf2feb7fa374d0708108/examples/webgl_shader.html#L54" target="_blank">example</a> shows. On the other hand, Three.js provides many <a href="https://github.com/mrdoob/three.js/tree/master/examples/js/shaders" target="_blank">frequently used shaders</a> so that you can apply shader effects by simply doing like this.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">edgeShader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderPass</span><span class="p">(</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">EdgeShader</span><span class="p">);</span></code></pre></figure>

<p>In this post, we are going to introduce how to use <code class="highlighter-rouge">THREE.ShaderPass</code> to write shaders for video from local camera and get pixel data from the rendered composer. We will take <code class="highlighter-rouge">THREE.EdgeShader</code> as example and read the rendered edges from it.</p>

<p>We are going to introduce in the following steps.</p>

<ol>
  <li>
    <p>Render local video to a plane in Three.js</p>

    <p>1.1	Including files and set up environments<br />
1.2	Getting video from local camera using <code class="highlighter-rouge">getUserMedia</code><br />
1.3	Creating a plane and use video as texture</p>
  </li>
  <li>
    <p>Set <code class="highlighter-rouge">THREE.EdgeShader</code> to video texture</p>

    <p>2.1	Including shader files<br />
2.2	Using <code class="highlighter-rouge">Three.EffectComposer</code><br />
2.3	Reading pixels</p>
  </li>
</ol>

<p>By the end of this post, you will be able to implement the effect at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-05.html" target="_blank">demo 2.3</a> and get the number of non-zero pixels on the screen.</p>

<h1 id="1-render-local-video-to-a-plane-in-threejs">1. Render local video to a plane in Three.js</h1>

<p>The result of this step is available at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-03.html" target="_blank">demo 1.3</a>.</p>

<h2 id="11-including-files-and-set-up-environments">1.1 Including files and set up environments</h2>

<p>If you are familiar with Three.js, this step may looks extremly easy for you.</p>

<p>We include the <code class="highlighter-rouge">three.js</code> file from <a href="https://github.com/mrdoob/three.js/tree/master/build" target="_blank">build directory</a> of Three.js repo on GitHub. And set up Three.js environment very simply, and create a canvas of size <code class="highlighter-rouge">400x300px</code>.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"http://zhangwenli.com/Polyvia/vendor/three.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
        
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
            <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'mainCanvas'</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">({</span>
                    <span class="na">canvas</span><span class="p">:</span> <span class="nx">canvas</span>
                <span class="p">});</span>
                <span class="nx">renderer</span><span class="p">.</span><span class="nx">setClearColor</span><span class="p">(</span><span class="mh">0x000000</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">tmpScene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>
                
                <span class="c1">// camera</span>
                <span class="c1">// canvas size is 400x300</span>
                <span class="kd">var</span> <span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">OrthographicCamera</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
                <span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
                <span class="nx">tmpScene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    
    <span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"init()"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">"mainCanvas"</span> <span class="na">width=</span><span class="s">"400px"</span> <span class="na">height=</span><span class="s">"300px"</span> <span class="nt">&gt;&lt;/canvas&gt;</span>
        <span class="nt">&lt;p&gt;</span>Black canvas is expected here.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>The result of this step is available at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-01.html" target="_blank">demo 1.1</a>.</p>

<h2 id="12-getting-video-from-local-camera-using-getusermedia">1.2 Getting video from local camera using <code class="highlighter-rouge">getUserMedia</code></h2>

<p>Next, we use <code class="highlighter-rouge">navigator.getUserMedia</code> to get the access to local camers.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// local video</span>
<span class="kd">var</span> <span class="nx">video</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'video'</span><span class="p">);</span>
<span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span> 
	<span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">webkitGetUserMedia</span>
    <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">mozGetUserMedia</span>
    <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">msGetUserMedia</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">navigator</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span>
        <span class="na">video</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">stream</span><span class="p">);</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">onloadedmetadata</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">video</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
        <span class="p">};</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">'Request camera failed'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">'getUserMedia not supported'</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The result of this step is available at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-02.html" target="_blank">demo 1.2</a>.</p>

<h2 id="13-creating-a-plane-and-use-video-as-texture">1.3 Creating a plane and use video as texture</h2>

<p>Next, we need to draw the video onto the canvas using Three.js. You may probably ask why not draw using canvas. This is because we will add shader effects afterwards, and thus we have to draw it using WebGL, which is in our case, using Three.js.</p>

<p>We first create a canvas named <code class="highlighter-rouge">videoImage</code> to draw the video onto. And then create a <code class="highlighter-rouge">THREE.Texture</code> named <code class="highlighter-rouge">videoTexture</code>, which is used as the map of the material of a plane whose position is just about the screen.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">videoImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'canvas'</span><span class="p">);</span>
<span class="nx">videoImage</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
<span class="nx">videoImage</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">videoImageContext</span> <span class="o">=</span> <span class="nx">videoImage</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">'2d'</span><span class="p">);</span>
<span class="c1">// background color if no video present</span>
<span class="nx">videoImageContext</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">'#ff0000'</span><span class="p">;</span>
<span class="nx">videoImageContext</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">videoImage</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">videoImage</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

<span class="nx">videoTexture</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Texture</span><span class="p">(</span><span class="nx">videoImage</span><span class="p">);</span>
<span class="nx">videoTexture</span><span class="p">.</span><span class="nx">minFilter</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">LinearFilter</span><span class="p">;</span>
<span class="nx">videoTexture</span><span class="p">.</span><span class="nx">magFilter</span> <span class="o">=</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">LinearFilter</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">videoMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshBasicMaterial</span><span class="p">({</span>
    <span class="na">map</span><span class="p">:</span> <span class="nx">videoTexture</span><span class="p">,</span>
    <span class="na">overdraw</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">videoGeometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PlaneGeometry</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">videoMesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">videoGeometry</span><span class="p">,</span> <span class="nx">videoMaterial</span><span class="p">);</span>
<span class="nx">videoMesh</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">tmpScene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">videoMesh</span><span class="p">);</span></code></pre></figure>

<p>Slow down to understand the above code carefully. And ask yourself, how is <code class="highlighter-rouge">video</code> passed to all these elements?</p>

<p>The answer is that we need to modify the callback function <code class="highlighter-rouge">video.onloadedmetadata</code>. In the following lines of code, <code class="highlighter-rouge">this.videoWidth</code> and <code class="highlighter-rouge">this.videoHeight</code> are the size of local camera, and we set that of canvas <code class="highlighter-rouge">videoImage</code> to be the same, so that the canvas renders only the video content, and without any black area. This is very important since it may bring about problems of position if we don’t do so.</p>

<p>Note that we set <code class="highlighter-rouge">videoTexture.needsUpdate</code> to be <code class="highlighter-rouge">true</code> so that when our renderer renders the plane with <code class="highlighter-rouge">videoTexture</code>, it knows the texture should be updated.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">video</span><span class="p">.</span><span class="nx">onloadedmetadata</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">videoImage</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">videoWidth</span><span class="p">;</span>
    <span class="nx">videoImage</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">videoHeight</span><span class="p">;</span>
    <span class="nx">video</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

    <span class="nx">renderFrame</span><span class="p">();</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">renderFrame</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">videoImageContext</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">video</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">videoTexture</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">videoTexture</span><span class="p">.</span><span class="nx">needsUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">tmpScene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">renderFrame</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>Now, we can see the effect of rendering local camera at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-03.html" target="_blank">demo 1.3</a>.</p>

<h1 id="2-set-threeedgeshader-to-video-texture">2. Set <code class="highlighter-rouge">THREE.EdgeShader</code> to video texture</h1>

<h2 id="21-including-shader-files">2.1 Including shader files</h2>

<p>Three.js shader files are available at <a href="https://github.com/mrdoob/three.js/tree/master/examples/js/shaders" target="_blank">examples/js/shaders</a>, which are not part of <code class="highlighter-rouge">three.js</code> or <code class="highlighter-rouge">three.min.js</code> in <code class="highlighter-rouge">build</code> directory. To use them, we need to include the corresponding files.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./three.CopyShader.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./three.EdgeShader.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./three.EffectComposer.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./three.MaskPass.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./three.RenderPass.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./three.ShaderPass.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<h2 id="22-using-threeeffectcomposer">2.2 Using <code class="highlighter-rouge">Three.EffectComposer</code></h2>

<p>Then, we create several passes to enable the shader effect.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">renderPass</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">RenderPass</span><span class="p">(</span><span class="nx">tmpScene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">edgeShader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderPass</span><span class="p">(</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">EdgeShader</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">effectCopy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">ShaderPass</span><span class="p">(</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">CopyShader</span><span class="p">);</span>
<span class="nx">effectCopy</span><span class="p">.</span><span class="nx">renderToScreen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">composer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">EffectComposer</span><span class="p">(</span><span class="nx">renderer</span><span class="p">);</span>
<span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">renderPass</span><span class="p">);</span>
<span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">edgeShader</span><span class="p">);</span>
<span class="nx">composer</span><span class="p">.</span><span class="nx">addPass</span><span class="p">(</span><span class="nx">effectCopy</span><span class="p">);</span></code></pre></figure>

<p>These passes work like a pipe. <code class="highlighter-rouge">RenderPass</code> passes the rendered texture in <code class="highlighter-rouge">tmpScene</code> to <code class="highlighter-rouge">EdgeShader</code>. <code class="highlighter-rouge">EdgeShader</code> uses edge detect algorithm to modify the edges in the texture to be white and other to be black, then passes to <code class="highlighter-rouge">CopyShader</code> to copy to screen. <code class="highlighter-rouge">EffectComposer</code> is used to compose these three passes and form into a pipeline.</p>

<p>And next, use <code class="highlighter-rouge">composer.render();</code> instead of <code class="highlighter-rouge">renderer.render(tmpScene, camera);</code>.</p>

<p><img class="post-img" src="http://shenjl.github.io/blog/img/loading.gif" data-src="http://shenjl.github.io/blog/img/post/2015-06-20-read-from-shader-texture-with-threejs.png" />The result of this step is available at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-04.html" target="_blank">demo 2.2</a>. Now, you are supposed to get something like this… if you are as cute as me! :joy:</p>

<h2 id="23-reading-pixels">2.3 Reading pixels</h2>

<p>Then, we can read the pixels from this canvas to get pixel information from GPU to CPU.</p>

<p><strong>CAUTION!! This is extremely time-consuming!!</strong></p>

<p>Then why?</p>

<p>Well, I guess this is not a very common requirement. So when I searched for this solution, I hardly found any. And this is also why I write this post. I will use the pixel data to form vertices on the edges to make <a href="https://en.wikipedia.org/?title=Delaunay_triangulation" target="_blank">Delaunay Triangles</a>. So I guess this is a must-be-paid large cost.</p>

<p>In <code class="highlighter-rouge">renderFrame</code>, we add the following lines to read pixels.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">pixels</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">getContext</span><span class="p">();</span>
<span class="nx">gl</span><span class="p">.</span><span class="nx">readPixels</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">,</span> <span class="nx">pixels</span><span class="p">);</span></code></pre></figure>

<p>Here, <code class="highlighter-rouge">pixels</code> is a one-dimensional arrary that contains colors in the order of <code class="highlighter-rouge">[red1, green1, blue1, alpha1, red2, green2, blue2, alpha2, ...]</code>. So we can output the count of non-zero red elements to make sure the pixels are read correctly.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">getNonZeroCnt</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">++</span><span class="nx">cnt</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">cnt</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>The result of this step is available at <a href="http://shenjl.github.io/blog/demo/2015-06-20-read-from-shader-texture-with-threejs-05.html" target="_blank">demo 2.3</a>.</p>

<h1 id="conclusion">Conclusion</h1>

<p>This post provides a solution to get pixels from canvas rendered using <code class="highlighter-rouge">EffectComposer</code>.</p>


    <div class="clear"></div>
    

    
        <blockquote class="seriesNote">

    <h4>Series: Polyvia</h4>

    
    <ul>
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/04/14/jade-for-github-pages/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Jade for GitHub Pages
            
            
            
                </a>
            
            </li>
        
    
        
    
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/05/29/upload-images-with-dat-gui/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Upload Images with dat.GUI
            
            
            
                </a>
            
            </li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/06/13/wrapping-third-party-libraries-for-requirejs/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Wrapping Third-Party Libraries for RequireJS
            
            
            
                </a>
            
            </li>
        
    
        
    
        
            
                <li class="series-self">
            
            
            
                Get Video from Local Camera & Read from Shader Texture with Three.js
            
            
            
            </li>
        
    
        
            
                <li class="series-not-self"><a href="http://shenjl.github.io/blog/2015/06/25/polyvia/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InSeries', window.location.pathname]);">
            
            
            
                Low-Poly 风格的图像、视频处理 Polyvia
            
            
            
                </a>
            
            </li>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
    </ul>
</blockquote>

    

    
    
    
    <hr />
    
    <p>微信公众号“羡辙部落格”（xianzheblog）提供本站优质非技术类博文推送。</p>
    <p class="no-indent"><a href="http://shenjl.github.io/blog/tip/" onclick="_gaq.push(['_trackEvent', 'ToTip', 'InPost', window.location.pathname]);">觉得博文很赞？来打赏一下我吧！——送羡辙一本书，让她写出更棒的作品！:heart_eyes: </a></p>
    
    <div class="social-share">
        <a class="social-share-element social-twitter" href="https://twitter.com/intent/tweet?text=Get Video from Local Camera & Read from Shader Texture with Three.js&url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/&via=OviliaZhang&hashtags=" target="_blank" title="Share this post on Twitter" onclick="_gaq.push(['_trackEvent', 'Share', 'Twitter', window.location.pathname]);"></a>
        <a class="social-share-element social-facebook" href="https://www.facebook.com/sharer/sharer.php?t=Get Video from Local Camera & Read from Shader Texture with Three.js&u=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/" target="_blank" title="Share this post on Facebook" onclick="_gaq.push(['_trackEvent', 'Share', 'Facebook', window.location.pathname]);"></a>
        <a class="social-share-element social-google" href="https://plus.google.com/share?url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/" target="_blank" title="Share this post on Google Plus" onclick="_gaq.push(['_trackEvent', 'Share', 'GPlus', window.location.pathname]);"></a>
        <a class="social-share-element social-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Get Video from Local Camera & Read from Shader Texture with Three.js&url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/&source=http%3a%2f%2fzhangwenli.com" target="_blank" title="Share this post on LinkedIn" onclick="_gaq.push(['_trackEvent', 'Share', 'LinkedIn', window.location.pathname]);"></a>
        <a class="social-share-element social-digg" href="http://digg.com/submit?url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/&title=Get Video from Local Camera & Read from Shader Texture with Three.js" target="_blank" title="Share this post on Digg" onclick="_gaq.push(['_trackEvent', 'Share', 'Digg', window.location.pathname]);"></a>
        <a class="social-share-element social-reddit" href="http://reddit.com/submit?url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/&title=Get Video from Local Camera & Read from Shader Texture with Three.js" target="_blank" title="Share this post on Reddit" onclick="_gaq.push(['_trackEvent', 'Share', 'Reddit', window.location.pathname]);"></a>
        <a class="social-share-element social-stumble" href="http://www.stumbleupon.com/submit?url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/&title=Get Video from Local Camera & Read from Shader Texture with Three.js" target="_blank" title="Share this post on StumbleUpon" onclick="_gaq.push(['_trackEvent', 'Share', 'StumbleUpon', window.location.pathname]);"></a>
        <a class="social-share-element social-weibo" href="http://v.t.sina.com.cn/share/share.php?title=来看看+%40羡辙+的博文吧：Get Video from Local Camera & Read from Shader Texture with Three.js&url=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/" target="_blank" title="Share this post on Sina Weibo" onclick="_gaq.push(['_trackEvent', 'Share', 'Weibo', window.location.pathname]);"></a>
        <a class="social-share-element social-douban" href="http://shuo.douban.com/!service/share?href=http://shenjl.github.io/blog/2015/06/20/read-from-shader-texture-with-threejs/&name=Get Video from Local Camera & Read from Shader Texture with Three.js" target="_blank" title="Share this post on Dounban" onclick="_gaq.push(['_trackEvent', 'Share', 'Douban', window.location.pathname]);"></a>
    </div>

    <blockquote class="relatedPosts">
        
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                        
                        <h4>Similar Posts</h4>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="http://shenjl.github.io/blog/2016/08/24/using-echarts-with-typescript/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRelated', window.location.pathname]);">
                            
                            
                            
                                Using ECharts with TypeScript
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://shenjl.github.io/blog/2016/07/27/non-ui-blocking-javascript/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRelated', window.location.pathname]);">
                            
                            
                            
                                Non UI-Blocking JavaScript
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://shenjl.github.io/blog/2015/12/27/upload-canvas-snapshot-to-nodejs/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRelated', window.location.pathname]);">
                            
                            
                            
                                Upload Canvas Snapshots to Node.js
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://shenjl.github.io/blog/2015/12/21/bos-access-with-bce/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRelated', window.location.pathname]);">
                            
                            
                            
                                使用 Node.js 在 BCE 上访问 BOS 的方法
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                        
                        <li class="relatedPost">
                            <a href="http://shenjl.github.io/blog/2015/12/19/render-jade-on-server-side/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRelated', window.location.pathname]);">
                            
                            
                            
                                Jade <code>renderFile</code>
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
            
                
            
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
            
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
                
                
                    
                
                    
                
                    
                
                    
                
                
            
        
        
            </ul>
        

        <h4>Recent Posts</h4>
        <ul>
        
            <li class="relatedPost">
                <a href="http://shenjl.github.io/blog/2017/01/31/reviewing-playing-pygmalion/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRecent', window.location.pathname]);">
                
                
                
                    爱你，还是爱自己：《皮格马利翁效应》读后感
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://shenjl.github.io/blog/2017/01/03/reading-report/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRecent', window.location.pathname]);">
                
                
                
                    2016 年读书小结
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://shenjl.github.io/blog/2016/12/31/goodbye-2016/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRecent', window.location.pathname]);">
                
                
                
                    2016 年度小结
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://shenjl.github.io/blog/2016/12/19/reviewing-the-neurotic-personality-of-our-time/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRecent', window.location.pathname]);">
                
                
                
                    来，我们一起发神经吧！：《我们时代的神经症人格》读后感
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://shenjl.github.io/blog/2016/12/03/reviewing-rhetoric/" onclick="_gaq.push(['_trackEvent', 'ToPost', 'InRecent', window.location.pathname]);">
                
                
                
                    言辞的边界：《修辞认识》读后感
                
                </a>
            </li>
        
        </ul>
        <a class="button" href="http://shenjl.github.io/blog/all" onclick="_gaq.push(['_trackEvent', 'ToAllPost', 'InPost', window.location.pathname]);">View All Posts</a></p>
    </blockquote>



    <div class="about-author">
    <div class="license">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">
            <img alt="Creative Commons License" style="border-width:0" src="http://shenjl.github.io/blog/img/cc.png" />
        </a>
        <div><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Every blog post in this site</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://zhangwenli.com" property="cc:attributionName" rel="cc:attributionURL">Wenli Zhang</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">CC 3.0 License</a>, based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="http://github.com/ovilia/blog" rel="dct:source">Github</a>. You can see the source code of this blog site at <a href="https://github.com/Ovilia/blog/tree/gh-pages" target="_blank">github.com/Ovilia/blog</a>.</div>
    </div>
    <div class="follow-me">
        <div class="follow-me-txt">Follow <strong>Wenli Zhang</strong> at</div>
        <a class="social-share-element social-twitter" href="https://twitter.com/OviliaZhang" target="_blank" title="Follow me on Twitter" onclick="_gaq.push(['_trackEvent', 'Follow', 'Twitter', window.location.pathname]);"></a>
<a class="social-share-element social-google" href="https://plus.google.com/u/0/112802684720065263732?rel=author" target="_blank" title="Follow me on Google Plus" onclick="_gaq.push(['_trackEvent', 'Follow', 'GPlus', window.location.pathname]);"></a>
<a class="social-share-element social-github" href="https://github.com/Ovilia" target="_blank" title="Follow me on GitHub" onclick="_gaq.push(['_trackEvent', 'Follow', 'GitHub', window.location.pathname]);"></a>
<a class="social-share-element social-so" href="http://stackoverflow.com/users/760314/ovilia" target="_blank" title="Follow me on StackOverflow" onclick="_gaq.push(['_trackEvent', 'Follow', 'StackOverflow', window.location.pathname]);"></a>
<a class="social-share-element social-linkedin" href="http://www.linkedin.com/profile/view?id=148742016" target="_blank" title="Follow me on LinkedIn" onclick="_gaq.push(['_trackEvent', 'Follow', 'LinkedIn', window.location.pathname]);"></a>
<a class="social-share-element social-dribbble" href="https://dribbble.com/wenli" target="_blank" title="Follow me on Dribbble" onclick="_gaq.push(['_trackEvent', 'Follow', 'Dribbble', window.location.pathname]);"></a>
<a class="social-share-element social-weibo" href="http://weibo.com/plainjane" target="_blank" title="Follow me on Sina Weibo" onclick="_gaq.push(['_trackEvent', 'Follow', 'Weibo', window.location.pathname]);"></a>
<a class="social-share-element social-douban" href="http://www.douban.com/people/ovilia1024/" target="_blank" title="Follow me on Douban" onclick="_gaq.push(['_trackEvent', 'Follow', 'Douban', window.location.pathname]);"></a>

    </div>
    <div style="clear: both"></div>
</div>


    
<h1>Comments</h1>



<div id="disqus_thread"></div>
<script type="text/javascript">
    setTimeout(function() {
        var disqus_shortname = 'wenli';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    }, 10000);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>
<div class="rotLeft rotBottom pageBack"></div>
<div class="rotRight rotBottom pageBack"></div>

            <div id="footer-nav">
                | <a href="#">Top</a> | 
                <a href="http://shenjl.github.io/blog">Blog</a> | 
                <a href="http://zhangwenli.com/#ovilia-home">About Me</a> |
                <a href="mailto:me@zhangwenli.com" target="_blank">Email</a> |
                <a href="http://shenjl.github.io/blog/feed.xml">RSS</a> | 
                <a href="http://shenjl.github.io/blog/meta">More</a> |
            </div>
            
            <div id="footer-follow">
                <a class="footer-follow-element footer-follow-twitter" href="https://twitter.com/OviliaZhang" target="_blank" title="Follow me on Twitter" onclick="_gaq.push(['_trackEvent', 'Follow', 'Twitter', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-google" href="https://plus.google.com/u/0/112802684720065263732?rel=author" target="_blank" title="Follow me on Google Plus" onclick="_gaq.push(['_trackEvent', 'Follow', 'GPlus', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-github" href="https://github.com/Ovilia" target="_blank" title="Follow me on GitHub" onclick="_gaq.push(['_trackEvent', 'Follow', 'GitHub', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-so" href="http://stackoverflow.com/users/760314/ovilia" target="_blank" title="Follow me on StackOverflow" onclick="_gaq.push(['_trackEvent', 'Follow', 'StackOverflow', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-linkedin" href="http://www.linkedin.com/profile/view?id=148742016" target="_blank" title="Follow me on LinkedIn" onclick="_gaq.push(['_trackEvent', 'Follow', 'LinkedIn', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-dribbble" href="https://dribbble.com/wenli" target="_blank" title="Follow me on Dribbble" onclick="_gaq.push(['_trackEvent', 'Follow', 'Dribbble', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-weibo" href="http://weibo.com/plainjane" target="_blank" title="Follow me on Sina Weibo" onclick="_gaq.push(['_trackEvent', 'Follow', 'Weibo', 'Footer']);"></a>
                <a class="footer-follow-element footer-follow-douban" href="http://www.douban.com/people/ovilia1024/" target="_blank" title="Follow me on Douban" onclick="_gaq.push(['_trackEvent', 'Follow', 'Douban', 'Footer']);"></a>
            </div>
        </div>
        
        <div id="footerDiv">
            <div id="footerImg"></div>
            <div id="footerCnt">
                <div id="footer">
                </div>
            </div>
        </div>

        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
            
        <script type="text/javascript" src="http://shenjl.github.io/blog/js/lazyLoad.js"></script>
        <script type="text/javascript" src="http://shenjl.github.io/blog/js/common.min.js"></script>
    </body>
</html>

